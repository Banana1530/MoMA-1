context("Fusion tests")


test_that("When lambda = 0, non-negative prox operators zero-out negative values", {
    set.seed(34)
    x <- 10 * runif(10)
    # result generated by flsa
    goal <-matrix(c(4.447685, 5.447685, 6.447685, 6.760676, 6.427343, 6.094010, 5.760676, 5.612593, 5.612593, 5.612593, 5.612593
                    ,9.985404, 8.417172, 7.417172, 6.760676, 6.427343, 6.094010, 5.760676, 5.612593, 5.612593, 5.612593, 5.612593
                    ,8.848940, 8.417172, 7.417172, 6.760676, 6.427343, 6.094010, 5.760676, 5.612593, 5.612593, 5.612593, 5.612593
                    ,2.384260, 3.328699, 4.328699, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593
                    ,2.273138, 3.328699, 4.328699, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593
                    ,8.477694, 6.477694, 5.237301, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593
                    ,2.825617, 4.825617, 5.237301, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593
                    ,7.176086, 5.294398, 5.237301, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593
                    ,3.960512, 5.294398, 5.237301, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593
                    ,5.746595, 5.294398, 5.237301, 5.120557, 5.263415, 5.406272, 5.549129, 5.612593, 5.612593, 5.612593, 5.612593),
                  nrow=10,
                  byrow=T)
    lambdas <- seq(0,10,1)
    for(l in 1:10){
        expect_lte(norm(test_prox_orderedfusion(x,lambdas[l])-matrix(goal[,l],nrow=10)),1e-5)
    }
})

# for(i in 1:10){
#     x <- 10 * runif(10)
#     flsaTopDown(x)
#     for(l in seq(0,10,0.3)){
#         expect_equal(test_prox_orderedfusion(x,l),t(flsaGetSolution(flsa(x),lambda2=l)))
#     }
# }
